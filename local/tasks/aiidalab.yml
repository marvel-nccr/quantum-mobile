- name: debug vm_qeapp_image
  debug:
    msg: "{{ vm_qeapp_image }}"

- name: Pull qeapp image
  command: "docker pull {{ vm_qeapp_image }}"

- name: Create qeapp container
  become: true
  become_user: "{{ vm_user }}"
  command: "docker run -d --name qeapp -p 8899:8888 --volume /home/{{ vm_user }}/qeapp-home:/home/jovyan {{ vm_qeapp_image }}"

- name: Copy AiiDAlab logo
  become: true
  become_user: "{{ root_user }}"
  copy:
    src: images/aiidalab-qe-logo.png
    dest: /usr/share/icons/

- name: create desktop shortcut to AiiDALab
  copy:
    dest: "${HOME}/Desktop/aiidalab.desktop"
    mode: "0753"
    content: |
      [Desktop Entry]
      Name=AiiDAlab QE
      Comment=Launch AiiDAlab QE
      Exec={{ vm_browser }} "http://localhost:8899/apps/apps/quantum-espresso/qe.ipynb?token=max"
      Terminal=false
      Icon=/usr/share/icons/aiidalab-qe-logo.png
      Type=Application
